<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Store System</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
body { font-family: 'Poppins', Arial, sans-serif; margin: 0; background: #f0f2f5; color: #333; }
.nav { display: flex; gap: 20px; background: #1e1e2f; padding: 15px 20px; }
.nav a { color: #fff; text-decoration: none; font-size: 18px; padding: 8px 15px; border-radius: 5px; transition: 0.3s; }
.nav a:hover { background: #343454; }
.nav a.active { font-weight: 600; background: #ffb800; color: #1e1e2f; }
section { display: none; padding: 20px; max-width: 1000px; margin: 20px auto; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 10px; }
section.active { display: block; }
input[type=text], input[type=number] { padding: 8px 12px; width: 250px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px; }
button { padding: 8px 15px; border: none; border-radius: 5px; background: #1e1e2f; color: white; cursor: pointer; transition: 0.3s; }
button:hover { background: #343454; }
.top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
table { width: 100%; border-collapse: collapse; border-radius: 8px; overflow: hidden; }
th, td { padding: 12px 10px; text-align: center; }
th { background: #f4f4f4; color: #222; font-weight: 600; }
tbody tr:nth-child(even) { background: #f9f9f9; }
.low-stock { color: #ff4d4d; font-weight: 600; }
.action-col button { padding: 5px 10px; font-size: 14px; border-radius: 5px; margin: 2px; cursor: pointer; transition: 0.3s; }
.action-col .edit-btn { background: #4CAF50; color: white; }
.action-col .edit-btn:hover { background: #45a049; }
.action-col .delete-btn { background: #ff4d4d; color: white; }
.action-col .delete-btn:hover { background: #e63946; }
tfoot td { font-weight: 600; background: #f4f4f4; }
@media print { .nav, #searchInput, #printBtn, .action-col { display: none; } body { background: white; } table { page-break-inside: auto; } tr { page-break-inside: avoid; page-break-after: auto; } }
</style>
</head>
<body>

<div class="nav">
    <a onclick="showPage('purchase')" id="navPurchase">Purchase</a>
    <a onclick="showPage('inventory')" id="navInventory">Inventory</a>
    <a onclick="showPage('sales')" id="navSales">Sales</a>
</div>

<section id="purchase">
    <h2>Purchase</h2>
    <label>Item name:</label><br><input id="pItem"><br>
    <label>Quantity purchased:</label><br><input id="pQty" type="number"><br>
    <label>Selling price:</label><br><input id="pPrice" type="number"><br><br>
    <button onclick="addPurchase()"><i class="fas fa-plus"></i> Add to Inventory</button>
</section>

<section id="inventory">
    <h1>Inventory</h1>
    <div class="top-bar">
        <input type="text" id="searchInput" placeholder="Search...">
        <button id="printBtn" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
    </div>
    <table id="inventoryTable">
        <thead>
            <tr>
                <th>Item name</th>
                <th>Qty remaining</th>
                <th>Selling price</th>
                <th>Total Qty sold</th>
                <th>Total value</th>
                <th class="action-col">Action</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="4">Grand Total</td>
                <td id="grandTotal">0</td>
                <td></td>
            </tr>
        </tfoot>
    </table>
</section>

<section id="sales">
    <h2>Sales</h2>
    <label>Item name:</label><br><input id="sItem"><br>
    <label>Quantity sold:</label><br><input id="sQty" type="number"><br><br>
    <button onclick="recordSale()"><i class="fas fa-dollar-sign"></i> Record Sale</button>
    <h3>Sales Records</h3>
    <table id="salesTable">
        <thead>
            <tr>
                <th>Item</th>
                <th>Qty Sold</th>
                <th>Selling Price</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="3">Overall Total</td>
                <td id="overallSales">0</td>
            </tr>
        </tfoot>
    </table>
</section>

<script>
let inventory = [];
let sales = [];
let overallSalesTotal = 0;

/* SAVE DATA */
function saveData() {
    localStorage.setItem('inventory', JSON.stringify(inventory));
    localStorage.setItem('salesRecords', JSON.stringify(sales));
    localStorage.setItem('overallSales', overallSalesTotal);
}

/* LOAD DATA */
function loadData() {
    let inv = localStorage.getItem('inventory');
    if (inv) inventory = JSON.parse(inv);

    let salesStored = localStorage.getItem('salesRecords');
    if (salesStored) sales = JSON.parse(salesStored);

    let salesTotal = localStorage.getItem('overallSales');
    if (salesTotal) overallSalesTotal = parseFloat(salesTotal);

    updateInventory();
    renderSales();
}

/* SHOW PAGE */
function showPage(page) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(page).classList.add("active");
    document.querySelectorAll(".nav a").forEach(a => a.classList.remove("active"));
    document.getElementById("nav" + page.charAt(0).toUpperCase() + page.slice(1)).classList.add("active");
}
showPage("inventory");

/* PURCHASE */
function addPurchase() {
    let name = pItem.value.trim().toLowerCase();
    let qty = parseInt(pQty.value);
    let price = parseFloat(pPrice.value);
    if (!name || qty <= 0 || price <= 0) return alert("Invalid input");
    let item = inventory.find(i => i.name === name);
    if (item) { item.qty += qty; item.price = price; }
    else inventory.push({ name, qty, price, sold: 0 });
    updateInventory();
    saveData();
    pItem.value = pQty.value = pPrice.value = "";
}

/* SALES */
function recordSale() {
    let name = sItem.value.trim().toLowerCase();
    let qty = parseInt(sQty.value);
    let item = inventory.find(i => i.name === name);
    if (!item) return alert("Item not found");
    if (qty <= 0 || qty > item.qty) return alert("Invalid quantity");

    item.qty -= qty;
    item.sold += qty;

    let total = qty * item.price;
    overallSalesTotal += total;

    sales.push({ name: item.name, qty, price: item.price, total });

    renderSales();
    updateInventory();
    saveData();

    sItem.value = sQty.value = "";
}

/* UPDATE INVENTORY */
function updateInventory() {
    let tbody = document.querySelector("#inventoryTable tbody");
    let grandTotal = 0;
    tbody.innerHTML = "";
    inventory.forEach(item => {
        let totalValue = (item.qty + item.sold) * item.price;
        grandTotal += totalValue;
        tbody.innerHTML += `
            <tr>
                <td>${item.name}</td>
                <td class="${item.qty <= 20 ? 'low-stock' : ''}">${item.qty}</td>
                <td>${item.price}</td>
                <td>${item.sold}</td>
                <td>${totalValue}</td>
                <td class="action-col">
                    <button class="edit-btn" onclick="editItem('${item.name}')"><i class="fas fa-edit"></i></button>
                    <button class="delete-btn" onclick="deleteItem('${item.name}')"><i class="fas fa-trash-alt"></i></button>
                </td>
            </tr>
        `;
    });
    document.getElementById("grandTotal").innerText = grandTotal;
}

/* DELETE ITEM */
function deleteItem(name) {
    if (!confirm("Are you sure you want to delete this item?")) return;
    inventory = inventory.filter(i => i.name !== name);
    sales = sales.filter(s => s.name !== name); // remove related sales
    updateInventory();
    renderSales();
    saveData();
}

/* EDIT ITEM */
function editItem(name) {
    let item = inventory.find(i => i.name === name);
    if (!item) return;
    let newQty = prompt("Enter new quantity:", item.qty);
    let newPrice = prompt("Enter new price:", item.price);
    if (newQty !== null) item.qty = parseInt(newQty);
    if (newPrice !== null) item.price = parseFloat(newPrice);

    // update related sales totals if needed
    sales.forEach(s => { if (s.name === name) s.price = item.price; });

    updateInventory();
    renderSales();
    saveData();
}

/* RENDER SALES TABLE */
function renderSales() {
    let tbody = document.querySelector("#salesTable tbody");
    tbody.innerHTML = "";
    sales.forEach(sale => {
        tbody.innerHTML += `
            <tr>
                <td>${sale.name}</td>
                <td>${sale.qty}</td>
                <td>${sale.price}</td>
                <td>${sale.total}</td>
            </tr>
        `;
    });
    document.getElementById("overallSales").innerText = overallSalesTotal;
}

/* SEARCH INVENTORY */
searchInput.addEventListener("keyup", () => {
    let value = searchInput.value.toLowerCase();
    document.querySelectorAll("#inventoryTable tbody tr").forEach(row => {
        let item = row.cells[0].innerText.toLowerCase();
        row.style.display = item.includes(value) ? "" : "none";
    });
});

// Load data on page load
loadData();
</script>
</body>
</html>
